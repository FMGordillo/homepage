---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";

const articles = await getCollection("articles");

function formatDate(date) {
  const [day, month, year] = date.split("/");
  const newDate = new Date(year, month - 1, day);

  console.log({ day, month, year, newDate });

  if (newDate.toString() === "Invalid Date") {
    return date;
  }

  return newDate.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  })
}
---

<Layout title="Facu's website">
  <div class="flex flex-col gap-16">
    <br />
    <h1 class="text-4xl md:text-6xl">Facundo Martin Gordillo's notes</h1>
    <ul
      class="grid gap-4 grid-cols-1"
    >
      {
        articles.map((article) => (
            <li data-slug={article.slug} class="grid grid-flow-col grid-cols-[120px_8px_auto] gap-4 rounded px-4 py-6 bg-gradient-to-r from-cyan-300 to-cyan-400 hover:cursor-pointer hover:to-cyan-500 dark:from-cyan-700 dark:to-cyan-800 dark:hover:to-cyan-600 transition">
              <span class="italic">{formatDate(article.data.date)}</span>
              <code>{"|"}</code>
              <span>{article.data.title}</span>
            </li>
      ))}
    </ul>
  </div>
  <script>
    const liEls = document.querySelectorAll("li");
    liEls.forEach(el => el.addEventListener('click', (e) => {
      const slug = e.srcElement.dataset.slug;
      window.location.href = `/articles/${slug}`
    }))
  </script>
</Layout>
